<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WiFi Aquatan Monitor</title>
<link rel="stylesheet" href="/pure.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
</head>
<body>
<div class="p-m pure-menu-horizontal pure-menu-scrollable pm-fix">
  <a href="#" class="pure-menu-heading"><img width='32' height='32' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IB2cksfwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAABnklEQVRYCb2XUVLEMAxDW4b7X7mgwssorp2mtDQzYMeWJcW7fLBs27bo56VzEPp4SVgyEl9/o+77+SSZiAf3xYxEdCKeOib2+6yBSCYBCJX7AVv1HbuMDEDUDdhF/SjCTKzbWJ9W34FZInCwSnhaXEOjDUBEFD4KqnbrZBuQiIu6QFYX/oqxjj8z4IJZLhOVkQw/NBcNAFYkz0hVmzURcbo3bjegopo+gJE28N3341jqzHCPseNyAw7ESCbgOOVgY70TsmbHGf8KsiEGsh4GPDqOHA7z8ZNWG3CgSCDyOjl9MJkYPWZanDHQwBMJQpUJzLa+fwQUIYl6Z33wmhcWvNfJW3x6AxDzUu6KGCLuPd+Ag5/K4zY7cYn81wamH3BlA/E10yIj4JsbOKxfxqoNZOA7G8j49sVkGxA4EytJdqb613ButIHMRC2Td4biGsk2ANXpMMA/Rj1wqzYAp0z4JtyU18HHeIZZRxuIZE/f98ecbSCKnr0o4qt72+RVAxXhTL2JOvjMwJ0Xp4Iurvzud6ASqepRf1lf/Nf8IK7CF5KQSk/UTlbbAAAAAElFTkSuQmCC'></a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item"><a href="#temp" class="pure-menu-link">Temperature</a></li>
    <li class="pure-menu-item"><a href="#pres" class="pure-menu-link">Pressure</a></li>
    <li class="pure-menu-item"><a href="#level" class="pure-menu-link">Level</a></li>
    <li class="pure-menu-item"><a href="#led" class="pure-menu-link">Led</a></li>
    <li class="pure-menu-item"><a href="#fan" class="pure-menu-link">Fan</a></li>
    <li class="pure-menu-item"><a href="#setting" class="pure-menu-link">Setting</a></li>
  </ul>
</div>

<div class="l-content">
  <div class="a-t pure-g">
    <div id="wtemp" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-water">
        <div class="at-header">
          <h2>Water Temperature</h2>
	  
          <span class="at-val">
            <div id="wt">40.0</div><span>&deg;C</span>
          </span>
        </div>
	
      </div>
    </div>

    <div id="atemp" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-air">
        <div class="at-header">
          <h2>Air Temperature</h2>
	  
          <span class="at-val">
            <div id="at">40.0</div><span>&deg;C</span>
          </span>
        </div>
	
      </div>
    </div>

    <div id="pres" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-pressure">
        <div class="at-header">
          <h2>Air Pressure</h2>
	  
          <span class="at-val">
            <div id="ap">1013.3</div><span>hPa</span>
          </span>
        </div>
      </div>
    </div>

    <div id="humid" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-humid">
        <div class="at-header">
          <h2>Humidity</h2>
	  
          <span class="at-val">
            <div id="hu">100</div><span>%</span>
          </span>
        </div>
      </div>
    </div>

    <div id="level" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-level">
        <div class="at-header">
          <h2>Water Level</h2>
	  
          <span class="at-val">
            <div id="wl">100</div><span>cm</span>
          </span>
        </div>
      </div>
    </div>

    <div id="led" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-lighting">
        <div class="at-header">
          <h2>Lighting</h2>

          <span class="at-val">
            <div id="ls">ON</div><span id="lv">255</span>
          </span>
        </div>
      </div>
    </div>
    
    <div id="fan" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-fan">
        <div class="at-header">
          <h2>Fan</h2>
	  
          <span class="at-val">
            <div id="fs">OFF</div><span id="fv">0</span>
          </span>
        </div>
      </div>
    </div>

    <div id="pump" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-fan">
        <div class="at-header">
          <h2>Pump</h2>
	  
          <span class="at-val">
            <div id="ps">OFF</div><span id="pv">0</span>
          </span>
        </div>
      </div>
    </div>

  </div> <!-- end a-t -->

  <div class="pure-g">
    <div class="pure-u-1-5 pure-u-md-1-2">
      <button id="sbtn" type="" class="pure-button">Show settings</button>
    </div>
    <div class="pure-u-1-5 pure-u-md-1-2">
    </div>
  </div>
  
  <div id="setting">
    <div id="sched" class="if pure-g">
      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Auto lighting schedule</h3>
          <p>Set the schedule of lighting.</p>
          <p>
	    <form name="/schedule" id="schedule" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Scheduler</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="use_schedule" value="1" type="checkbox"> Enable
		  </div>
		</div>
		<legend>Turn on time</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="on_h" class="pure-u-22-24" type="text" placeholder="hour">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="on_m" class="pure-u-22-24" type="text" placeholder="min">
		  </div>
		  <div class="pure-u-1 pure-u-md-3-5">
		  </div>
		</div>
		<legend>Turn off time</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="off_h" class="pure-u-22-24" type="text" placeholder="hour">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="off_m" class="pure-u-22-24" type="text" placeholder="min">
		  </div>
		  <div class="pure-u-1 pure-u-md-3-5">
		  </div>
		</div>

		<legend>Turn on/off duration</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="use_slow" value="1" type="checkbox"> Turn on/off slowly
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="duration" class="pure-u-22-24" type="text" placeholder="seconds">
		  </div>
		</div>

		<button id="ssub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div id="thres" class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Fan control</h3>
          <p>Set the temperature limits for activating cooling fan. The cooling fan tries to maintain the water temperature between the higher and lower limits. </p>
	  <p>
	    <form id="autofan" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Automatic fan control</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="use_autofan" value="1" type="checkbox"> Enable
		  </div>
		</div>
		<legend>Water Temperature</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-2">
		    <label for="hi_l">Higher</label>
		    <input id="hi_l" class="pure-u-20-24" type="text" placeholder="Higher limit">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-2">
		    <label for="lo_l">Lower</label>
		    <input id="lo_l" class="pure-u-20-24" type="text" placeholder="Lower limit">
		  </div>
		</div>
		<button id="tsub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div id="wlevel" class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Water Level</h3>
          <p>Set the water levels to notify full and low water. The bi-color LED lights in green for normal, orange for full, and red for low level.</p>
	  <p>
	    <form id="wlv" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Automatic pump control</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="use_pump" value="1" type="checkbox"> Enable
		  </div>
		</div>
		<legend>Water levels</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-2">
		    <label for="lv_hi">Full</label>
		    <input id="lv_hi" class="pure-u-20-24" type="text" placeholder="Level (cm)">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-2">
		    <label for="lv_lo">Low</label>
		    <input id="lv_lo" class="pure-u-20-24" type="text" placeholder="Level (cm)">
		  </div>
		</div>
		<button id="wsub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div id="twitter" class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Twitter setting</h3>
          <p>Use Twitter via <a href="http://stewgate-u.appspot.com">Stewgate</a>.</p>
	  <p>
	    <form id="twitconf" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Twitter post</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="use_twitter" value="1" type="checkbox"> Enable twitter post
		  </div>
		</div>
		<legend>Access token</legend>		
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="stew_token" class="pure-u-20-24" type="text" placeholder="Stewgate access token">
		  </div>		  
		</div>
		<button id="twsub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset WiFi settings</h3>
          <p>Reset the WiFi AP setting by clicking this button.</p>
	  <p>
	    <form action="/wifireset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset ALL settings</h3>
          <p>Reset the ALL setting by clicking this button.</p>
	  <p>
	    <form action="/reset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>	
    </div> <!-- end if -->
  </div> <!-- end setting -->
</div> <!-- end l-content -->
<div class="footer l-box">
    <p>
        WiFi Aquatan Monitor by @omzn 2015-2016 / All rights researved
    </p>
</div>
<script type="text/javascript">

$(function(){
    $('a[href^=#]').click(function() {
	var speed = 400;
	var href= $(this).attr("href");
	var target = $(href == "#" || href == "" ? 'html' : href);
	var position = target.offset().top - 48;
	$('body,html').animate({scrollTop:position}, speed, 'swing');
	return false;
    });
});

$('form#schedule').submit(
    function(ev) {
	$.post('/schedule',
	       "use_schedule="+$('#use_schedule').prop('checked').toString()+
	       "&on_h="+$('#on_h').val()+"&on_m="+$('#on_m').val()+
	       "&off_h="+$('#off_h').val()+"&off_m="+$('#off_m').val()+
	       "&use_slow="+$('#use_slow').prop('checked').toString()+
	       "&duration="+$('#duration').val(),
	       read1,"json");
	$('#ssub').prop('disabled', true);
	return false;
    });

$('form#autofan').submit(
    function(ev) {
	$.post('/autofan',
	       "use_autofan="+$('#use_autofan').prop('checked').toString()+
	       "&hi_l="+$('#hi_l').val()+"&lo_l="+$('#lo_l').val(),
	       read2,"json");
	$('#tsub').prop('disabled', true);
	return false;
    });

$('form#wlv').submit(
    function(ev) {
	$.post('/wlevel',
	       "use_pump="+$('#use_pump').prop('checked').toString()+
	       "&lv_lo="+$('#lv_lo').val()+"&lv_hi="+$('#lv_hi').val(),
	       read4,"json");
	$('#wsub').prop('disabled', true);
	return false;
    });

$('form#twitconf').submit(
    function(ev) {
	$.post('/twitconf',
	       "use_twitter="+$('#use_twitter').prop('checked').toString()+
	       "&stew_token="+$('#stew_token').val(),
	       read3,"json");
	$('#twsub').prop('disabled', true);
	return false;
    });

function read1(json){
    $('#on_h').val(json.on_h);
    $('#on_m').val(json.on_m);
    $('#off_h').val(json.off_h);
    $('#off_m').val(json.off_m);
    if (json.use_schedule == 1) {
	$('#use_schedule').prop("checked",true);
    } else {
	$('#use_schedule').prop("checked",false);
    }
    if (json.use_slow == 1) {
	$('#use_slow').prop("checked",true);
    } else {
	$('#use_slow').prop("checked",false);
    }
    $('#duration').val(json.duration);
}

function read2(json){
    $('#hi_l').val(json.hi_l);
    $('#lo_l').val(json.lo_l);
    if (json.use_autofan == 1) {
	$('#use_autofan').prop("checked",true);
    } else {
	$('#use_tnctl').prop("checked",false);
    }
}

function read3(json) {
    $('#stew_token').val(json.stew_token);
    if (json.use_twitter == 1) {
      $('#use_twitter').prop("checked",true);
    } else {
	$('#use_twitter').prop("checked",false);
    }
}

function read4(json){
    $('#lv_hi').val(json.lv_hi);
    $('#lv_lo').val(json.lv_lo);
    if (json.use_pump == 1) {
	$('#use_pump').prop("checked",true);
    } else {
	$('#use_pump').prop("checked",false);
    }
}

function upd() {
    $.getJSON('/measure',function(json){
	$('#wt').html(json.water_temp.toFixed(1).toString());
	$('#at').html(json.air_temp.toFixed(1).toString());
	if (json.air_temp < -100) {
	    $('#atemp').hide();
	}
	$('#ap').html(json.pressure.toFixed().toString());
	if (json.pressure < 500) {
	    $('#pres').hide();
	}
	$('#wl').html(json.water_level.toString());
	$('#hu').html(json.humidity.toFixed(1).toString());
	if (json.humidity < 0) {
	    $('#humid').hide();
	}
	$('#lv').html(json.led.toString());
	$('#fv').html(json.fan.toString());
	if ( json.led > 0) {
	    $('#ls').html("ON");
	} else {
	    $('#ls').html("OFF");
	}
	if ( json.fan > 0) {
	    $('#fs').html("ON");
	} else {
	    $('#fs').html("OFF");
	}
	if(json.pump == null) {
	    $('#pump').hide();
	} else {
	    if ( json.pump > 0) {
		$('#ps').html("ON");
	    } else {
		$('#ps').html("OFF");
	    }
	}
    });
}

function confset() {
    $.getJSON('/config',function(json){
	read1(json);
	read2(json);
	read3(json);
	read4(json);
	if($('#use_autofan').is(":checked")){
	    $('#hi_l').prop('disabled', false);
	    $('#lo_l').prop('disabled', false);
	} else {
	    $('#tsub').prop('disabled', true);
	    $('#hi_l').prop('disabled', true);
	    $('#lo_l').prop('disabled', true);
	}
	if($('#use_schedule').is(":checked")){
	    $('#on_h').prop('disabled', false);
	    $('#on_m').prop('disabled', false);
	    $('#off_h').prop('disabled', false);
	    $('#off_m').prop('disabled', false);
	    $('#use_slow').prop('disabled', false);
	    if($('#use_slow').is(":checked")){
		$('#duration').prop('disabled', false);
	    } else {
		$('#duration').prop('disabled', true);    
	    }
	} else {
	    $('#ssub').prop('disabled', true);
	    $('#on_h').prop('disabled', true);
	    $('#on_m').prop('disabled', true);
	    $('#off_h').prop('disabled', true);
	    $('#off_m').prop('disabled', true);
	    $('#use_slow').prop('disabled', true);
	    $('#duration').prop('disabled', true);    
	}
	if($('#use_twitter').is(":checked")){
	    $('#stew_token').prop('disabled', false);
	} else {
	    $('#twsub').prop('disabled', true);
	    $('#stew_token').prop('disabled', true);
	}
    });
}

$(function() {
    $('#use_schedule').click(function(){
	if($(this).is(":checked")){
	    $('#on_h').prop('disabled', false);
	    $('#on_m').prop('disabled', false);
	    $('#off_h').prop('disabled', false);
	    $('#off_m').prop('disabled', false);
	    $('#use_slow').prop('disabled', false);
	    if($('#use_slow').is(":checked")){
		$('#duration').prop('disabled', false);
	    } else {
		$('#duration').prop('disabled', true);    
	    }
	} else if($(this).is(":not(:checked)")){
	    $('#ssub').prop('disabled', true);
	    $('#on_h').prop('disabled', true);
	    $('#on_m').prop('disabled', true);
	    $('#off_h').prop('disabled', true);
	    $('#off_m').prop('disabled', true);
	    $('#use_slow').prop('disabled', true);
	    $('#duration').prop('disabled', true);    
	    $.post('/schedule',
		   "use_schedule="+$('#use_schedule').prop('checked').toString()+
		   "&on_h="+$('#on_h').val()+"&on_m="+$('#on_m').val()+
		   "&off_h="+$('#off_h').val()+"&off_m="+$('#off_m').val()+
		   "&use_slow="+$('#use_slow').prop('checked').toString()+
		   "&duration="+$('#duration').val(),
		   read1,"json");
	}
    });

    $('#use_slow').click(function(){
	if($(this).is(":checked")){
	    $('#duration').prop('disabled', false);
	} else {
	    $('#duration').prop('disabled', true);    
	    $.post('/schedule',
		   "use_schedule="+$('#use_schedule').prop('checked').toString()+
		   "&on_h="+$('#on_h').val()+"&on_m="+$('#on_m').val()+
		   "&off_h="+$('#off_h').val()+"&off_m="+$('#off_m').val()+
		   "&use_slow="+$('#use_slow').prop('checked').toString()+
		   "&duration="+$('#duration').val(),
		   read1,"json");
	}
    });
    
    $('#use_autofan').click(function(){
	if($(this).is(":checked")){
	    $('#hi_l').prop('disabled', false);
	    $('#lo_l').prop('disabled', false);
	} else if($(this).is(":not(:checked)")){
	    $('#tsub').prop('disabled', true);
	    $('#hi_l').prop('disabled', true);
	    $('#lo_l').prop('disabled', true);
	    $.post('/autofan',
		   "use_autofan="+$('#use_autofan').prop('checked').toString()+
		   "&hi_l="+$('#hi_l').val()+"&lo_l="+$('#lo_l').val(),
		   read2,"json");
	}
    });

    $('#use_pump').click(function(){
	$.post('/wlevel',
	       "use_pump="+$('#use_pump').prop('checked').toString()+
	       "&lv_hi="+$('#lv_hi').val()+"&lv_lo="+$('#lv_lo').val(),
	       read4,"json");
    });
		    
    $('#use_twitter').click(function(){
	if($(this).is(":checked")){
	    $('#twsub').prop('disabled', false);
	    $('#stew_token').prop('disabled', false);
	} else if($(this).is(":not(:checked)")){
	    $('#twsub').prop('disabled', true);
	    $('#stew_token').prop('disabled', true);
	    $.post('/twitconf',
		   "use_twitter="+$('#use_twitter').prop('checked').toString()+
		   "&stew_token="+$('#stew_token').val(),
		   read3,"json");
	}
    });
    
    $('#ssub').prop('disabled', true);
    $('#tsub').prop('disabled', true);
    $('#wsub').prop('disabled', true);
    $('#twsub').prop('disabled', true);

    $('#stew_token').keyup(function() {
	if($(this).val() != '') {
	    $('#twsub').prop('disabled', false);
	}
    });
    
    $('#lv_hi').keyup(function() {
	if($(this).val() != '') {
	    $('#wsub').prop('disabled', false);
	}
    });

    $('#lv_lo').keyup(function() {
	if($(this).val() != '') {
	    $('#wsub').prop('disabled', false);
	}
    });

    $('#on_h').keyup(function() {
	if($(this).val() != '') {
	    $('#ssub').prop('disabled', false);
	}
    });
    
    $('#on_m').keyup(function() {
	if($(this).val() != '') {
	    $('#ssub').prop('disabled', false);
	}
    });

    $('#off_h').keyup(function() {
	if($(this).val() != '') {
	    $('#ssub').prop('disabled', false);
	}
    });

    $('#off_m').keyup(function() {
	if($(this).val() != '') {
	    $('#ssub').prop('disabled', false);
	}
    });

    $('#duration').keyup(function() {
	if($(this).val() != '') {
	    $('#ssub').prop('disabled', false);
	}
    });

    $('#hi_l').keyup(function() {
	if($(this).val() != '') {
	    $('#tsub').prop('disabled', false);
	}
    });

    $('#lo_l').keyup(function() {
	if($(this).val() != '') {
	    $('#tsub').prop('disabled', false);
	}
    });

    $('#sbtn').click(function(){
	$('#setting').toggle();
    });

    confset();
    upd();
    setInterval("upd()",30000);

});

</script>
</body>
</html>
